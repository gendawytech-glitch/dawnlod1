
<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Descargar Historias de TikTok Sin Marca de Agua | TikElite</title>
    <meta name="description" content="Guarda Historias (Stories) de TikTok en calidad HD sin marca de agua. Nuestro descargador de Historias de TikTok, gratuito y rápido, funciona para cualquier usuario. Mira y descarga historias de forma anónima." />
    <meta name="keywords" content="descargar historias de tiktok, guardar story de tiktok, descargador de historias de tiktok, anónimo, sin marca de agua" />
    <link rel="canonical" href="https://example.com/es/download/stories.html" />
    
    <link rel="alternate" hreflang="x-default" href="https://example.com/download/stories.html" />
    <link rel="alternate" hreflang="en" href="https://example.com/download/stories.html" />
    <link rel="alternate" hreflang="ar" href="https://example.com/ar/download/stories.html" />
    <link rel="alternate" hreflang="es" href="https://example.com/es/download/stories.html" />
    <link rel="alternate" hreflang="fr" href="https://example.com/fr/download/stories.html" />
    <link rel="alternate" hreflang="de" href="https://example.com/de/download/stories.html" />
    <link rel="alternate" hreflang="pt" href="https://example.com/pt/download/stories.html" />
    <link rel="alternate" hreflang="ru" href="https://example.com/ru/download/stories.html" />
    <link rel="alternate" hreflang="hi" href="https://example.com/hi/download/stories.html" />
    <link rel="alternate" hreflang="ja" href="https://example.com/ja/download/stories.html" />
    <link rel="alternate" hreflang="zh" href="https://example.com/zh/download/stories.html" />
    <link rel="alternate" hreflang="ko" href="https://example.com/ko/download/stories.html" />

    <meta property="og:title" content="Descargar Historias de TikTok Sin Marca de Agua - TikElite" />
    <meta property="og:description" content="La forma más fácil de descargar y guardar Historias de TikTok en calidad HD sin ninguna marca de agua. Gratis, anónimo y funciona en todos los dispositivos." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://example.com/es/download/stories.html" />
    <meta property="og:image" content="https://example.com/og-image-stories.png" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="preconnect" href="https://www.tikwm.com" crossorigin>

    <script type="application/ld+json" id="json-ld-schema">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Descargador de Historias de TikTok TikElite",
      "url": "https://example.com/es/download/stories.html"
    }
    </script>
    <style>
        :root { --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1); --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        html.light { --bg-color: #f9fafb; --grad-1: #a8b2ff; --grad-2: #c6a8ff; --grad-3: #ffb3b8; --glass-bg: rgba(255, 255, 255, 0.4); --glass-border: rgba(255, 255, 255, 0.6); --card-bg: rgba(255, 255, 255, 0.65); --text-primary: #111827; --text-secondary: #4b5563; --text-tertiary: #6b7280; --accent-color: #4f46e5; --accent-hover: #4338ca; --green-color: #16a34a; --green-hover: #15803d; --red-color: #dc2626; --header-bg: transparent; --header-text: white; }
        html.dark { --bg-color: #0f172a; --grad-1: #1e293b; --grad-2: #334155; --grad-3: #475569; --glass-bg: rgba(30, 41, 59, 0.3); --glass-border: rgba(255, 255, 255, 0.1); --card-bg: rgba(30, 41, 59, 0.5); --text-primary: #f8fafc; --text-secondary: #cbd5e1; --text-tertiary: #94a3b8; --accent-color: #6366f1; --accent-hover: #4f46e5; --green-color: #22c55e; --green-hover: #16a34a; --red-color: #ef4444; --header-bg: transparent; --header-text: white; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        body { margin: 0; font-family: var(--font-family); color: var(--text-primary); background-color: var(--bg-color); transition: color 0.3s, background-color 0.3s; padding: 1rem; padding-top: 80px; min-height: 100vh; box-sizing: border-box; }
        body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; height: 400px; z-index: -2; background: linear-gradient(-45deg, var(--grad-1), var(--grad-2), var(--grad-3)); background-size: 400% 400%; animation: gradient-animation 20s ease infinite; transition: background 0.5s; }
        .container { max-width: 800px; margin: 0 auto; }
        .page-header, .content-section { text-align: center; margin: 3rem 0; animation: fade-in 0.6s backwards; }
        h1 { font-size: clamp(2.2rem, 6vw, 3.5rem); font-weight: 800; margin: 0 0 0.5rem 0; line-height: 1.2; }
        h2 { font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: 700; margin-bottom: 1.5rem; }
        .page-header p { color: var(--text-secondary); font-size: clamp(1rem, 3vw, 1.15rem); margin: 0 auto; max-width: 650px; line-height: 1.6; }
        .sticky-header { position: fixed; top: 0; left: 0; right: 0; padding: 0 1rem; height: 70px; z-index: 1000; display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, #4f46e5, #a855f7); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-size: 1.5rem; font-weight: 700; text-decoration: none; color: var(--header-text); }
        .nav-container { display: flex; align-items: center; gap: 1rem; }
        .nav-links { display: flex; align-items: center; gap: 1.5rem; }
        .nav-links a { text-decoration: none; color: rgba(255,255,255,0.8); font-weight: 500; transition: color 0.2s; }
        .nav-links a:hover, .nav-links a.active { color: white; }
        #theme-toggle + label { cursor: pointer; font-size: 1.5rem; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: rgba(255,255,255,0.8); transition: all 0.3s; }
        .dark #sun-icon { display: none; } .light #moon-icon { display: none; }
        .menu-toggle { display: none; background: none; border: none; cursor: pointer; padding: 0.5rem; z-index: 1001; }
        .menu-toggle .hamburger { display: block; width: 24px; height: 2px; background: white; position: relative; transition: all 0.3s; }
        .menu-toggle .hamburger::before, .menu-toggle .hamburger::after { content: ''; position: absolute; left: 0; width: 24px; height: 2px; background: white; transition: all 0.3s; }
        .menu-toggle .hamburger::before { top: -8px; }
        .menu-toggle .hamburger::after { bottom: -8px; }
        .glass-card { background: var(--glass-bg); border: 1px solid var(--glass-border); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-radius: 1.5rem; padding: 2rem; box-shadow: var(--shadow-lg); transition: background 0.3s, border 0.3s; animation: fade-in 0.5s; }
        .main-form-card { background: linear-gradient(135deg, #4f46e5, #a855f7, #ec4899); padding: 2.5rem 2rem; }
        #tiktok-form { display: flex; flex-direction: column; gap: 1rem; }
        #tiktok-url { width: 100%; padding: 1.1rem; background: rgba(0, 0, 0, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 0.75rem; font-size: 1rem; box-sizing: border-box; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2) inset; }
        #submit-btn { display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; padding: 1.1rem; border-radius: 0.75rem; background-color: rgba(255, 255, 255, 0.95); color: var(--accent-hover); border: none; font-size: 1.2rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .spinner { width: 22px; height: 22px; border: 3px solid rgba(79, 70, 229, 0.3); border-top-color: var(--accent-hover); border-radius: 50%; animation: spin 1s linear infinite; }
        #error-message { color: var(--red-color); background-color: color-mix(in srgb, var(--red-color) 15%, transparent); border: 1px solid var(--red-color); border-radius: 0.75rem; padding: 1rem; animation: fade-in 0.5s; }
        .author-info { display: flex; align-items: center; gap: 1rem; }
        .author-info img { width: 60px; height: 60px; border-radius: 50%; }
        .author-nickname { font-weight: 700; font-size: 1.2rem; }
        .stories-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .story-item { position: relative; }
        .story-item-thumbnail { width: 100%; aspect-ratio: 9/16; object-fit: cover; border-radius: 0.75rem; }
        .story-item .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background-color: rgba(0,0,0,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .story-item .play-icon svg { width: 24px; height: 24px; fill: white; }
        .story-item .download-btn { display: flex; align-items: center; justify-content: center; text-align: center; padding: 0.75rem; border: none; border-radius: 0.5rem; background-color: var(--green-color); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; text-decoration: none; transition: all 0.2s; width:100%; margin-top:0.5rem; box-sizing: border-box; }
        .adsense-slot { width: 100%; min-height: 90px; margin: 1.5rem 0; background-color: var(--glass-bg); border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; color: var(--text-tertiary); font-size: 0.9rem; border-radius: 0.75rem; text-align: center; }
        #ad-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.75); z-index: 9999; display: flex; align-items: center; justify-content: center; animation: fade-in 0.3s; }
        .ad-overlay-content { background: var(--card-bg); border: 1px solid var(--glass-border); backdrop-filter: blur(16px); padding: 2rem; border-radius: 1rem; text-align: center; max-width: 90%; width: 500px; box-shadow: var(--shadow-lg); }
        #ad-overlay-skip { background: var(--accent-color); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-size: 1rem; cursor: pointer; margin-top: 1rem; transition: all 0.2s; }
        .steps-grid, .features-grid { display: grid; gap: 1.5rem; margin-top: 2rem; }
        .step-card { background: var(--glass-bg); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--glass-border); }
        .step-card .number { font-size: 1.5rem; font-weight: 700; color: var(--accent-color); background-color: color-mix(in srgb, var(--accent-color) 15%, transparent); width: 40px; height: 40px; line-height: 40px; border-radius: 50%; margin: 0 auto 1rem auto; }
        .feature-item { background: var(--glass-bg); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--glass-border); display: flex; align-items: flex-start; gap: 1rem; text-align: left; }
        .feature-item svg { color: var(--green-color); width: 24px; height: 24px; flex-shrink: 0; margin-top: 2px; }
        .faq-section details { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 1rem; margin-bottom: 1rem; padding: 1rem; }
        .faq-section summary { font-weight: 600; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        .faq-section summary::after { content: '+'; font-size: 1.5rem; transition: transform 0.2s; }
        .faq-section details[open] summary::after { transform: rotate(45deg); }
        footer { text-align: center; margin-top: 4rem; padding: 3rem 1rem 2rem 1rem; font-size: 0.9rem; background: linear-gradient(135deg, #4338ca, #7e22ce, #be185d); color: #e5e7eb; border-radius: 1.5rem 1.5rem 0 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); }
        .footer-content { max-width: 900px; margin: 0 auto 2rem auto; text-align: left; line-height: 1.7; color: #d1d5db; }
        .footer-nav { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 1rem; }
        .footer-nav a { color: #f9fafb; text-decoration: none; font-weight: 500; }
        #periodic-ad-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.85); z-index: 10000; display: flex; align-items: center; justify-content: center; animation: fade-in 0.3s; }
        .close-ad-btn { position: absolute; top: -15px; right: -15px; width: 40px; height: 40px; border-radius: 50%; border: none; background: white; color: #333; font-size: 2rem; font-weight: bold; cursor: pointer; line-height: 40px; text-align: center; padding: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 10001; }
        [hidden] { display: none !important; }
        @media (max-width: 768px) { .menu-toggle { display: block; } .nav-links { position: fixed; top: 70px; right: 0; width: 250px; height: calc(100vh - 70px); background: #39339a; flex-direction: column; align-items: flex-start; padding: 1.5rem; transform: translateX(100%); transition: transform 0.3s ease-in-out; gap: 1rem; } .nav-links.active { transform: translateX(0); } }
    </style>
</head>
<body class="">
    <header class="sticky-header">
        <a href="/es/" class="logo">TikElite</a>
        <div class="nav-container">
            <nav class="nav-links" id="nav-links">
                <a href="/es/download/stories.html" class="active">Descargar Historias de TikTok</a>
                <a href="/es/download/mp3.html">Descargar MP3 de TikTok</a>
            </nav>
            <div class="theme-switcher">
                <input type="checkbox" id="theme-toggle" aria-label="Cambiar Tema">
                <label for="theme-toggle" title="Cambiar Tema"><svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></label>
            </div>
            <button class="menu-toggle" id="menu-toggle" aria-label="Abrir Menú"><span class="hamburger"></span></button>
        </div>
    </header>
    
    <div class="container">
        <section class="page-header">
            <h1>Descargar Historias de TikTok Sin Marca de Agua</h1>
            <p>Pega cualquier enlace de video o perfil de TikTok para guardar Historias de forma anónima. Nuestro guardador de Historias de TikTok es la mejor manera de obtener videos y fotos de alta calidad de la Historia de cualquier usuario.</p>
        </section>

        <div class="adsense-slot" id="adsense-top-banner">AdSense: Banner Superior</div>

        <main class="glass-card main-form-card">
            <form id="tiktok-form" role="search">
                <input type="url" id="tiktok-url" name="url" placeholder="Pega el enlace de video o perfil de TikTok aquí..." required aria-label="Entrada de URL de TikTok" />
                <button type="submit" id="submit-btn"><span>Descargar</span></button>
            </form>
             <div class="adsense-slot" style="margin-top: 1.5rem; margin-bottom: 0;">AdSense: Debajo del Input</div>
        </main>
        
        <section id="status-container" class="status-container">
            <div class="adsense-slot" id="adsense-above-results" hidden>AdSense: Encima de los Resultados</div>
            <div id="error-message" hidden></div>
            <div id="results"></div>
        </section>
        
        <section class="content-section" style="animation-delay: 0.2s;">
            <h2>Cómo Guardar una Historia de TikTok</h2>
            <div class="steps-grid">
                <div class="step-card"><div class="number">1</div><h3>Encuentra un Perfil de TikTok</h3><p>Abre la app de TikTok y ve al perfil del usuario cuya historia quieres guardar.</p></div>
                <div class="step-card"><div class="number">2</div><h3>Copia el Enlace del Perfil</h3><p>Toca los tres puntos en la esquina superior derecha, luego "Compartir perfil" y "Copiar enlace".</p></div>
                <div class="step-card"><div class="number">3</div><h3>Pega y Descarga</h3><p>Pega el enlace en nuestro descargador, haz clic en "Descargar" y guarda la Historia.</p></div>
            </div>
        </section>

        <section class="content-section" style="animation-delay: 0.4s;">
            <h2>Características Clave de Nuestro Descargador de Historias</h2>
            <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg><div><h3>Visualización Anónima</h3><p>Descarga y mira cualquier Historia pública de TikTok sin que el creador lo sepa. Tu actividad es completamente privada.</p></div></div>
                <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg><div><h3>Soporte para Fotos y Videos</h3><p>Nuestra herramienta admite tanto videos como fotos de las Historias de TikTok, guardándolos en la mejor calidad posible.</p></div></div>
                <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18.24-1.42-1.42a9 9 0 1 0-12.02 12.02l1.42 1.42a3 3 0 0 0 4.24 0l4.24-4.24a3 3 0 0 0 0-4.24Z"></path><path d="m14.5 11.5 1-1"></path><path d="m11.5 14.5 1-1"></path><path d="m22 2-6 6"></path></svg><div><h3>Sin Marcas de Agua</h3><p>Al igual que con los videos, todas las Historias descargadas están 100% libres de cualquier logo o marca de agua de TikTok.</p></div></div>
                <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h4"></path><rect x="8" y="7" width="8" height="10" rx="1" ry="1"></rect><path d="M16 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path></svg><div><h3>Todos los Dispositivos</h3><p>Usa nuestro guardador de Historias en tu iPhone, Android o computadora. Funciona perfectamente en cualquier navegador web moderno.</p></div></div>
            </div>
        </section>

        <section class="content-section faq-section" style="animation-delay: 0.6s;">
            <h2>Preguntas Frecuentes sobre Historias de TikTok</h2>
            <details><summary>¿Puedo descargar Historias de cuentas privadas?</summary><p>No. Para proteger la privacidad de los usuarios, nuestra herramienta solo te permite descargar historias de cuentas públicas de TikTok. No puedes acceder al contenido de perfiles privados.</p></details>
            <details><summary>¿Cuánto tiempo están disponibles las Historias de TikTok?</summary><p>Las Historias de TikTok desaparecen después de 24 horas. Si quieres guardar una historia, debes hacerlo antes de que expire. Nuestra herramienta no puede acceder a historias caducadas.</p></details>
            <details><summary>¿Sabrá el usuario que descargué su Historia?</summary><p>No. Nuestro servicio es completamente anónimo. El usuario no recibirá ninguna notificación de que has visto o descargado el contenido de su Historia.</p></details>
        </section>

        <footer>
            <div class="footer-content">
                <h3>Tu Herramienta Principal para Descargar de TikTok</h3>
                <p>TikElite es un servicio en línea líder diseñado para descargar videos, historias y audio MP3 de TikTok sin marcas de agua. Nuestra plataforma es una de las mejores alternativas a servicios como ssstik, snaptik y tikwm, ofreciendo una experiencia superior, rápida y confiable. Ya sea que quieras guardar un clip divertido en tu galería, descargar una historia de TikTok antes de que desaparezca o convertir un sonido viral a MP3, nuestra herramienta proporciona descargas de la más alta calidad de forma gratuita. Estamos dedicados a mantener un servicio simple, seguro y accesible para todos los usuarios en cualquier dispositivo, incluyendo iPhone, Android y PC. Guarda tu contenido favorito de TikTok en HD sin esfuerzo con TikElite.</p>
                <h3>Descargo de responsabilidad</h3>
                <p>Este servicio no está afiliado con TikTok o ByteDance Ltd. Todos los derechos de contenido pertenecen a sus respectivos dueños. TikElite no aloja ningún contenido pirateado o con derechos de autor en sus servidores, y todos los videos descargados se procesan directamente desde los servidores de TikTok. Por favor, asegúrate de tener permiso del creador del contenido antes de distribuir su trabajo.</p>
            </div>
            <div class="footer-nav">
                <a href="/es/pages/about.html">Sobre Nosotros</a>
                <a href="/es/pages/privacy.html">Política de Privacidad</a>
                <a href="/es/pages/contact.html">Contacto</a>
            </div>
            <p class="copyright">&copy; 2024 TikElite. Todos los derechos reservados.</p>
        </footer>
    </div>

    <div id="ad-overlay" hidden><div class="ad-overlay-content"><p>¡Tu descarga está lista!</p><div class="adsense-interstitial">AdSense: Intersticial</div><button id="ad-overlay-skip" disabled>Continuar en 7s</button></div></div>
    <div class="adsense-slot" id="adsense-sticky-footer">AdSense: Banner Fijo Inferior</div>
    <div id="periodic-ad-overlay" hidden><div class="ad-content-wrapper"><button class="close-ad-btn" id="close-periodic-ad" aria-label="Cerrar Anuncio">&times;</button><div class="ad-placeholder"><p>Publicidad</p></div></div></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('tiktok-form');
        const urlInput = document.getElementById('tiktok-url');
        const submitBtn = document.getElementById('submit-btn');
        const errorMessage = document.getElementById('error-message');
        const resultsContainer = document.getElementById('results');
        const adOverlay = document.getElementById('ad-overlay');
        const adOverlaySkipBtn = document.getElementById('ad-overlay-skip');
        const adAboveResults = document.getElementById('adsense-above-results');
        const themeToggle = document.getElementById('theme-toggle');
        const menuToggle = document.getElementById('menu-toggle');
        const navLinks = document.getElementById('nav-links');
        
        menuToggle.addEventListener('click', () => { navLinks.classList.toggle('active'); document.body.classList.toggle('nav-open'); });

        const applyTheme = (theme) => { document.documentElement.className = theme; themeToggle.checked = theme === 'dark'; };
        const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(currentTheme);
        themeToggle.addEventListener('change', () => { const newTheme = themeToggle.checked ? 'dark' : 'light'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const tiktokUrl = urlInput.value.trim();
            if (!tiktokUrl) { showError('Por favor, pega una URL de TikTok válida.'); return; }
            setLoadingState(true);
            hideStatus();
            try {
                const response = await fetch(`https://www.tikwm.com/api/?url=${encodeURIComponent(tiktokUrl)}`);
                if (!response.ok) throw new Error(`Error de red: ${response.statusText}`);
                const data = await response.json();
                if (data.code !== 0) throw new Error(data.msg || 'No se pudo obtener el contenido. Puede que sea privado, haya sido eliminado o el enlace no sea válido.');
                triggerAdOverlay(() => displayResults(data.data));
            } catch (error) { showError(error.message); } finally { setLoadingState(false); }
        });

        function setLoadingState(isLoading) {
            submitBtn.disabled = isLoading;
            submitBtn.innerHTML = isLoading ? '<div class="spinner"></div><span>Procesando...</span>' : '<span>Descargar</span>';
        }

        function hideStatus() {
            errorMessage.hidden = true;
            resultsContainer.innerHTML = '';
            adAboveResults.hidden = true;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.hidden = false;
        }

        function triggerAdOverlay(callback) {
            adOverlay.hidden = false;
            let countdown = 7;
            adOverlaySkipBtn.textContent = `Continuar en ${countdown}s`;
            adOverlaySkipBtn.disabled = true;
            const interval = setInterval(() => {
                countdown--;
                if (countdown <= 0) { clearInterval(interval); adOverlaySkipBtn.disabled = false; adOverlaySkipBtn.textContent = 'Continuar a la Descarga'; } 
                else { adOverlaySkipBtn.textContent = `Continuar en ${countdown}s`; }
            }, 1000);
            adOverlaySkipBtn.onclick = () => {
                clearInterval(interval);
                adOverlay.hidden = true;
                callback();
                setTimeout(() => { resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
            };
        }

        function displayResults(data) {
            adAboveResults.hidden = false;
            if (data.images && data.images.length > 0) {
                const storyFilenamePrefix = `@${data.author.unique_id}-historia`;
                let storyHTML = '';
                data.images.forEach((imageUrl, index) => {
                    const isVideo = imageUrl.includes('.mp4');
                    const filename = `${storyFilenamePrefix}-${index + 1}.${isVideo ? 'mp4' : 'jpg'}`;
                    const posterUrl = isVideo ? data.cover : imageUrl;
                    storyHTML += `
                        <div class="story-item">
                            <img src="${posterUrl}" alt="Diapositiva de Historia de TikTok ${index + 1}" loading="lazy" class="story-item-thumbnail">
                            ${isVideo ? `<div class="play-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg></div>` : ''}
                            <a href="${imageUrl}" download="${filename}" class="download-btn">Descargar Diapositiva ${index + 1}</a>
                        </div>`;
                });
                resultsContainer.innerHTML = `
                    <article class="glass-card">
                        <div class="author-info"><img src="${data.author.avatar}" alt="Avatar de ${data.author.nickname}" loading="lazy"><div><p class="author-nickname">${data.author.nickname}</p><p class="author-unique-id">@${data.author.unique_id}</p></div></div>
                        <h3 style="text-align:center; margin: 1.5rem 0 1rem;">${data.images.length} Historias Encontradas</h3>
                        <div class="stories-grid">${storyHTML}</div>
                    </article>`;
            } else { showError('No se pudo encontrar una historia o video descargable. Es posible que el usuario no tenga una historia activa o que el enlace no sea válido.'); }
        }
        
        const periodicAdOverlay = document.getElementById('periodic-ad-overlay');
        const closePeriodicAdBtn = document.getElementById('close-periodic-ad');
        if (periodicAdOverlay && closePeriodicAdBtn) {
            const AD_INTERVAL = 20 * 60 * 1000;
            const lastAdShown = localStorage.getItem('lastAdShownTimestamp');
            const now = new Date().getTime();
            if (!lastAdShown || (now - parseInt(lastAdShown, 10)) > AD_INTERVAL) {
                setTimeout(() => { periodicAdOverlay.hidden = false; document.body.style.overflow = 'hidden'; localStorage.setItem('lastAdShownTimestamp', now.toString()); }, 1000);
            }
            closePeriodicAdBtn.addEventListener('click', () => { periodicAdOverlay.hidden = true; document.body.style.overflow = ''; });
        }
    });
</script>
</body>
</html>
